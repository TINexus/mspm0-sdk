<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>无传感器 FOC 电机控制库概述 &mdash; Sensorless FOC Motor Control User Guide 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DRV8323RS GUI User Guide" href="drv8323rs/DRV8323RS_GUI_User_Guide_CN.html" />
    <link rel="prev" title="Sensorless FOC Motor Control User Guide" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Sensorless FOC Motor Control User Guide
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">无传感器 FOC 电机控制库概述</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">1. 软件概述</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">1.1 应用层概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hal">1.2 HAL 模块</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">概述</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id4">1.3 电机驱动器模块</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">电机驱动器引脚关联</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api">电机驱动器 API</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id6">1.4 无传感器 FOC 库模块</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id7">概述</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#mspm0-driverlib">1.5 MSPM0 DriverLib 概述</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id8">2. 软件用户指南</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">2.1 设置电机参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">2.2 设置系统参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">2.3 选择构建级别</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">重要说明</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">2.4 用于控制电机的变量</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">2.5 电机运行</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">2.6 电机调优</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pi">PI 控制器调优</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">2.7 记录变量</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spi">2.8 访问 SPI 寄存器</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id17">3. API 指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id18">4. 已知问题</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id19">5. 支持的器件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#drv8323rs">DRV8323RS</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="drv8323rs/DRV8323RS_GUI_User_Guide_CN.html">DRV8323RS GUI User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="drv8323rs/DRV8323RS_Hardware_User_Guide_CN.html">DRV8323RS Hardware User Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Sensorless FOC Motor Control User Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>无传感器 FOC 电机控制库概述</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="foc">
<h1>无传感器 FOC 电机控制库概述<a class="headerlink" href="#foc" title="Permalink to this heading">¶</a></h1>
<section id="id1">
<h2>1. 软件概述<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<p>无传感器磁场定向控制 (FOC) 库包含三个主要层：应用层、HAL 层和 MSPM0 DriverLib。</p>
<figure class="align-default" id="id20">
<img alt="无传感器 FOC 架构" src="../_images/Library-Architecture.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">无传感器 FOC 架构</span><a class="headerlink" href="#id20" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="id2">
<h3>1.1 应用层概述<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<p>用户特定的应用程序（例如 GUI）位于该层。在这一层，可以配置和使用电机驱动器模块的各种实例。如果用户需要执行任何硬件特定的操作，建议使用 HAL 模块中的 API。</p>
</section>
<section id="hal">
<h3>1.2 HAL 模块<a class="headerlink" href="#hal" title="Permalink to this heading">¶</a></h3>
<section id="id3">
<h4>概述<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h4>
<p>硬件抽象层 (HAL) 会创建一个抽象层，以提供用于配置不同引脚和外设的 API。使用 HAL 的目标是抽象处理所有器件特定的配置，从而通过最大程度地减少其他元件所需的更新来简化库到各种硬件的移植。HAL 旨在仅抽象处理应用所需的引脚或外设，同时仍然具有移植到其他 MSPM0 MCU 或电机驱动器的灵活性和可扩展性。</p>
<p>HAL 旨在将特定数量的引脚或通道与外设关联。例如，考虑 GPIO 的用例。HAL 具有枚举 HAL_GPIO_OUT_PIN，其中将所有 GPIO 输出引脚包含为成员，如下所示。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/*! @enum HAL_GPIO_OUT_PIN */
typedef enum{
    /*! Index associated to output GPIO PIN 0 */
    HAL_GPIO_OUT_PIN_0 = 0,
    /*! Index associated to output GPIO PIN 1 */
    HAL_GPIO_OUT_PIN_1,
    /*! Total number of output GPIO pins */
    HAL_GPIO_OUT_PIN_MAX,
}HAL_GPIO_OUT_PIN;
</pre></div>
</div>
<p>为了将 HAL GPIO 引脚映射到真实的硬件引脚，使用了一个由 HAL_GPIO_OUT_PIN 枚举成员进行索引的结构。该结构存储各种成员，如端口实例、引脚名称等。请参见下面的 gpioOUT 结构，该结构会保存有关端口和引脚的数据。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gpioOUT</span><span class="p">[</span><span class="n">HAL_GPIO_OUT_PIN_0</span><span class="p">]</span><span class="o">.</span><span class="n">iomux</span>   <span class="o">=</span> <span class="n">GENERIC_GPIO_OUT_PINO_0_IOMUX</span><span class="p">;</span>
<span class="n">gpioOUT</span><span class="p">[</span><span class="n">HAL_GPIO_OUT_PIN_0</span><span class="p">]</span><span class="o">.</span><span class="n">port</span>    <span class="o">=</span> <span class="n">GENERIC_GPIO_OUT_PORT</span><span class="p">;</span>
<span class="n">gpioOUT</span><span class="p">[</span><span class="n">HAL_GPIO_OUT_PIN_0</span><span class="p">]</span><span class="o">.</span><span class="n">pin</span>     <span class="o">=</span> <span class="n">GENERIC_GPIO_OUT_PINO_0_PIN</span><span class="p">;</span>
</pre></div>
</div>
<p>请注意，GENERIC_GPIO_OUT_PINO_0_PIN 在 TI SysConfig 生成的文件中定义，具体行如下所示：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define GENERIC_GPIO_OUT_PINO_0_PIN                             (DL_GPIO_PIN_26)</span>
</pre></div>
</div>
<p>因此，HAL_GPIO_OUT_PIN_0 间接引用 DL_GPIO_PIN_0，但这种映射的优点是：由于 TI SysConfig 控制 GENERIC_GPIO_OUT_PINO_0_PIN 的生成，因此很容易在 TI SysConfig GUI 中更改引脚。HAL 会自动遵循此行为，而无需用户更改 HAL 层中的任何代码。</p>
<p>如上所示，当通过 HAL 访问硬件时，我们需要传递 HAL 特定枚举，如 HAL_GPIO_OUT_PIN_0。这些枚举存储在访问 HAL 层的实例中。对于 DRV8323RS 电机驱动器，我们使用被分配给 HAL 枚举的引脚来初始化重要引脚的实例，如下面的代码片段所示。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">drv8323rs</span><span class="o">.</span><span class="n">enable</span>  <span class="o">=</span> <span class="n">HAL_GPIO_OUT_PIN_0</span><span class="p">;</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">nfault</span>  <span class="o">=</span> <span class="n">HAL_PWM_FAULT_0</span><span class="p">;</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">spi</span>     <span class="o">=</span> <span class="n">HAL_SPI_CHANNEL_0</span><span class="p">;</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">spiCS</span>   <span class="o">=</span> <span class="n">HAL_SPI_CS_2</span><span class="p">;</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">vsenvm</span>  <span class="o">=</span> <span class="n">HAL_ADC_CHANNEL_1</span><span class="p">;</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">isena</span>   <span class="o">=</span> <span class="n">HAL_ADC_CHANNEL_2</span><span class="p">;</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">isenb</span>   <span class="o">=</span> <span class="n">HAL_ADC_CHANNEL_0</span><span class="p">;</span>
</pre></div>
</div>
<p>如果需要将 ENABLE 引脚设置为高电平，则使用 API DRV8323RS_enable() 并通过其传递 DRV8323RS 实例。代码片段如下所示：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">DRV8323RS_enable</span><span class="p">(</span><span class="n">DRV8323RS_Instance</span> <span class="o">*</span><span class="n">handle</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">/*</span> <span class="n">Enable</span> <span class="n">the</span> <span class="n">DRV8323RS</span> <span class="o">*/</span>
    <span class="n">HAL_setGPIOVal</span><span class="p">(</span><span class="n">handle</span><span class="o">-&gt;</span><span class="n">enable</span><span class="p">,</span> <span class="n">HAL_GPIO_VALUE_HIGH</span><span class="p">);</span>

    <span class="o">/*</span> <span class="n">Startup</span> <span class="n">delay</span> <span class="k">for</span> <span class="n">the</span> <span class="n">DRV8323RS</span> <span class="n">SPI</span> <span class="n">to</span> <span class="n">be</span> <span class="n">ready</span> <span class="o">*/</span>
    <span class="n">HAL_delayMilliSeconds</span><span class="p">(</span><span class="n">DRV8323RS_SPI_READY_DELAY_MS</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>当 DRV8323RS_enable() 与 HAL 层交互时，会传递 DRV8323RS 实例的成员。这与使用其他 HAL API（例如计时器、SPI、DAC 等）的概念相同。用户可以随意扩展 HAL 的 API 以支持 MSPM0 的其他外设和特性，但为了确保能轻松迁移到该库的新版本，强烈建议不要修改现有的 API。</p>
</section>
</section>
<section id="id4">
<h3>1.3 电机驱动器模块<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h3>
<p>电机驱动器模块将 HAL API 用作电机驱动器特定操作 API，例如 SPI 读取、SPI 写入、电压和电流测量。该模块的理念是独立于硬件并使用 HAL API 来执行电机驱动器特定的硬件任务。</p>
<section id="id5">
<h4>电机驱动器引脚关联<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h4>
<p>在使用电机驱动器模块之前，用户需要指定映射到电机驱动器实例的 HAL 枚举。请参阅以下代码片段。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">Assign</span> <span class="n">the</span> <span class="n">pins</span> <span class="n">specific</span> <span class="k">for</span> <span class="n">the</span> <span class="n">DRV</span> <span class="o">*/</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">enable</span>  <span class="o">=</span> <span class="n">HAL_GPIO_OUT_PIN_0</span><span class="p">;</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">nfault</span>  <span class="o">=</span> <span class="n">HAL_PWM_FAULT_0</span><span class="p">;</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">spi</span>     <span class="o">=</span> <span class="n">HAL_SPI_CHANNEL_0</span><span class="p">;</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">spiCS</span>   <span class="o">=</span> <span class="n">HAL_SPI_CS_2</span><span class="p">;</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">vsenvm</span>  <span class="o">=</span> <span class="n">HAL_ADC_CHANNEL_1</span><span class="p">;</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">isena</span>   <span class="o">=</span> <span class="n">HAL_ADC_CHANNEL_2</span><span class="p">;</span>
<span class="n">drv8323rs</span><span class="o">.</span><span class="n">isenb</span>   <span class="o">=</span> <span class="n">HAL_ADC_CHANNEL_0</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="api">
<h4>电机驱动器 API<a class="headerlink" href="#api" title="Permalink to this heading">¶</a></h4>
<p>电机驱动器模块提供简单的 API，用户可以将其与电机驱动器模块的实例一同使用。 电机驱动器模块 API 还处理电机驱动器特定逻辑，同时保持 API 通用，因此用户可以使用不同的电机驱动器，而不必担心内部逻辑有任何差异。例如，下面是用于更新 drv8323rs 中 SPI 寄存器的 API。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">DRV8323RS_spiUpdateRegister</span><span class="p">(</span><span class="n">DRV8323RS_Instance</span> <span class="o">*</span><span class="n">handle</span><span class="p">,</span>
                      <span class="n">DRV8323RS_REG_ADDR</span> <span class="n">addr</span><span class="p">,</span> <span class="n">uint32_t</span> <span class="n">mask</span><span class="p">,</span> <span class="n">uint16_t</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">uint16_t</span> <span class="n">dataValue</span><span class="p">;</span>
    <span class="n">dataValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">uint16_t</span><span class="p">)</span> <span class="n">DRV8323RS_spiRead</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
    <span class="n">dataValue</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">mask</span><span class="p">);</span>
    <span class="n">dataValue</span><span class="o">|=</span> <span class="n">data</span><span class="p">;</span>
    <span class="n">DRV8323RS_spiWrite</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">dataValue</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>请注意，在上面的代码片段中，DRV8323RS 中 spi 寄存器的任何位都可以修改。不同器件的寄存器地址可以不同，但这里使用枚举器 DRV8323RS_REG_ADDR，因此用户不需要知道每个寄存器的地址。</p>
</section>
</section>
<section id="id6">
<h3>1.4 无传感器 FOC 库模块<a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h3>
<section id="id7">
<h4>概述<a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h4>
<p>无传感器 FOC 库包含用于三相无传感器 FOC 电机控制的通用算法。用户可以使用该模块中的 API 来配置和控制 FOC 电机控制。该模块负责根据 FOC 算法设置 PWM 调制，并通过 HAL API 来使用任何硬件资源。用户需要为 FOC 模块映射 HAL PWM 通道。下面是将 HAL PWM 通道分配给 foc 模块的代码片段。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">Assign</span> <span class="n">the</span> <span class="n">pins</span> <span class="n">specific</span> <span class="k">for</span> <span class="n">FOC</span> <span class="o">*/</span>
<span class="n">foc</span><span class="o">.</span><span class="n">pwmAHal</span> <span class="o">=</span> <span class="n">HAL_PWM_CHANNEL_1</span><span class="p">;</span>
<span class="n">foc</span><span class="o">.</span><span class="n">pwmBHal</span> <span class="o">=</span> <span class="n">HAL_PWM_CHANNEL_2</span><span class="p">;</span>
<span class="n">foc</span><span class="o">.</span><span class="n">pwmCHal</span> <span class="o">=</span> <span class="n">HAL_PWM_CHANNEL_0</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
<section id="mspm0-driverlib">
<h3>1.5 MSPM0 DriverLib 概述<a class="headerlink" href="#mspm0-driverlib" title="Permalink to this heading">¶</a></h3>
<p>MSPM0 DriverLib 是一组功能齐全的 API，用于配置、控制和操作 MSPM0 平台的硬件外设。更多信息，请参阅 DriverLib 文档。</p>
</section>
</section>
<section id="id8">
<h2>2. 软件用户指南<a class="headerlink" href="#id8" title="Permalink to this heading">¶</a></h2>
<p>无传感器 FOC 软件可与 CCS 调试窗口一同使用。如果用户想将该软件和 GUI 一同使用，请查看特定硬件的 GUI 用户指南。</p>
<section id="id9">
<h3>2.1 设置电机参数<a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h3>
<p>电机参数可以在 motor_parameter.h 文件中找到。无传感器 FOC 需要四个电机参数：</p>
<ul class="simple">
<li><p>定子电阻，Rs (Ω)</p></li>
<li><p>定子电感，Ls (H)</p></li>
<li><p>电机极数量</p></li>
<li><p>电机基准 RPM 最大值</p></li>
</ul>
<figure class="align-default" id="id21">
<img alt="电机参数 c 文件位置" src="../_images/FOC_MOTOR_PARAMS.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text">电机参数 c 文件位置</span><a class="headerlink" href="#id21" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>这些参数是使用电机的 #elif 语句定义的。若要为自定义电机定义这些参数，请修改 USER_MOTOR 的 #define 语句中的 MOTOR_PARA_RS、MOTOR_PARA_LS、MOTOR_PARA_POLES 和 MOTOR_PARA_BASE_RPM。若要添加另一个电机，请复制并粘贴下面的 #elif 语句，并将 USER_MOTOR 重命名为另一个名称。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#elif (USER_MOTOR)</span>
<span class="o">/*</span> <span class="n">Define</span> <span class="n">the</span> <span class="n">electrical</span> <span class="n">motor</span> <span class="n">parameters</span> <span class="p">(</span><span class="n">User</span> <span class="n">motor</span><span class="p">)</span> <span class="o">*/</span>
<span class="o">/*</span> <span class="nd">@brief</span> <span class="n">Stator</span> <span class="n">resistance</span> <span class="p">(</span><span class="n">ohm</span><span class="p">)</span> <span class="o">*/</span>
<span class="c1">#define MOTOR_PARA_RS               1.7</span>
<span class="o">/*</span> <span class="nd">@brief</span> <span class="n">Stator</span> <span class="n">inductance</span> <span class="p">(</span><span class="n">H</span><span class="p">)</span> <span class="o">*/</span>
<span class="c1">#define MOTOR_PARA_LS               0.004</span>
<span class="o">/*</span> <span class="nd">@brief</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">poles</span> <span class="o">*/</span>
<span class="c1">#define MOTOR_PARA_POLES            8</span>
<span class="o">/*</span> <span class="nd">@brief</span> <span class="n">Base</span> <span class="n">RPM</span> <span class="o">*/</span>
<span class="c1">#define MOTOR_PARA_BASE_RPM         5000</span>
</pre></div>
</div>
<p>若要选择在 motor_params.h 中定义的电机，请点击工具栏中的“Project”-&gt;“Properties”。 在“Properties”窗口中，依次转到“Build”-&gt;“Arm Compiler”-&gt;“Predefined Symbols”。预定义的电机名称为 LVSERVOMTR=1。若要更改预定义的电机名称，请点击 “Edit” 并将 LVSERVOMTR 更改为 motor_params.h 中定义的另一个电机，例如 LVBLDCMTR 或 USER_MOTOR。</p>
<figure class="align-default" id="id22">
<img alt="显示 LVSERVOMTR=1 符号" src="../_images/CCS_PREDEFINED_SYMBOL.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">显示 LVSERVOMTR=1 符号</span><a class="headerlink" href="#id22" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="id10">
<h3>2.2 设置系统参数<a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h3>
<p>初始参数可在 drv8323rs-gui.h 文件中找到，具体形式为 #define GUI_DEFAULT_XXXX。用户必须根据需要设置这些参数。默认情况下，为 LVSERVOMTR 电机设置默认参数。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>初始参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DRV_VDS_LVL</p></td>
<td><p>DRV8323RS 的 VDS 比较器阈值</p></td>
</tr>
<tr class="row-odd"><td><p>DRV_SEN_LVL</p></td>
<td><p>DRV8323RS 的 OCP 电平</p></td>
</tr>
<tr class="row-even"><td><p>DRV_CSA_GAIN</p></td>
<td><p>DRV8323RS 的 CSA 增益设置</p></td>
</tr>
<tr class="row-odd"><td><p>DRV_RSHUNT</p></td>
<td><p>DRV8323RS 中的 Rshunt 阻值</p></td>
</tr>
<tr class="row-even"><td><p>FOC_RS</p></td>
<td><p>为 FOC 选择的电机相电阻</p></td>
</tr>
<tr class="row-odd"><td><p>FOC_LS</p></td>
<td><p>为 FOC 选择的电机相电感</p></td>
</tr>
<tr class="row-even"><td><p>FOC_POLES</p></td>
<td><p>为 FOC 选择的电机极</p></td>
</tr>
<tr class="row-odd"><td><p>FOC_BASE_RPM</p></td>
<td><p>为 FOC 选择的基准 rpm</p></td>
</tr>
<tr class="row-even"><td><p>FOC_PWMFREQ</p></td>
<td><p>FOC 的 PWM 频率</p></td>
</tr>
<tr class="row-odd"><td><p>FOC_PWMADCSAMPLE</p></td>
<td><p>ADC 采样中的 PWM 计数</p></td>
</tr>
<tr class="row-even"><td><p>FOC_CNTRLDIV</p></td>
<td><p>FOC 的控制环路分压器，仅设置为 1</p></td>
</tr>
<tr class="row-odd"><td><p>FOC_DEADBAND</p></td>
<td><p>死区，以 ns 为单位</p></td>
</tr>
<tr class="row-even"><td><p>FOC_RSHUNT</p></td>
<td><p>Rshunt 电阻值</p></td>
</tr>
<tr class="row-odd"><td><p>FOC_VOLT_RATIO</p></td>
<td><p>总线电压转换率</p></td>
</tr>
<tr class="row-even"><td><p>FOC_AMP_GAIN</p></td>
<td><p>电流放大器增益</p></td>
</tr>
<tr class="row-odd"><td><p>FOC_KSLIDE</p></td>
<td><p>Kslide 系数值</p></td>
</tr>
<tr class="row-even"><td><p>FOC_PISPD_KP</p></td>
<td><p>速度 PI 控制器的比例系数</p></td>
</tr>
<tr class="row-odd"><td><p>FOC_PISPD_KI</p></td>
<td><p>速度 PI 控制器的积分系数</p></td>
</tr>
<tr class="row-even"><td><p>FOC_PISPD_MAX</p></td>
<td><p>速度 PI 控制器的最大值输出</p></td>
</tr>
<tr class="row-odd"><td><p>FOC_PISPD_MIN</p></td>
<td><p>速度 PI 控制器的最小值输出</p></td>
</tr>
<tr class="row-even"><td><p>FOC_PISPD_DIV</p></td>
<td><p>针对 FOC 控制环路频率的速度 PI 控制器执行分频器</p></td>
</tr>
<tr class="row-odd"><td><p>FOC_PIIQ_KP</p></td>
<td><p>Iq PI 控制器的比例系数</p></td>
</tr>
<tr class="row-even"><td><p>FOC_PIIQ_KI</p></td>
<td><p>Iq PI 控制器的积分系数</p></td>
</tr>
<tr class="row-odd"><td><p>FOC_PIIQ_MAX</p></td>
<td><p>Iq PI 控制器的最大值输出</p></td>
</tr>
<tr class="row-even"><td><p>FOC_PIIQ_MIN</p></td>
<td><p>Iq PI 控制器的最小值输出</p></td>
</tr>
<tr class="row-odd"><td><p>FOC_PIID_KP</p></td>
<td><p>Id PI 控制器的比例系数</p></td>
</tr>
<tr class="row-even"><td><p>FOC_PIID_KI</p></td>
<td><p>Id PI 控制器的积分系数</p></td>
</tr>
<tr class="row-odd"><td><p>FOC_PIID_MAX</p></td>
<td><p>Id PI 控制器的最大值输出</p></td>
</tr>
<tr class="row-even"><td><p>FOC_PIID_MIN</p></td>
<td><p>Id PI 控制器的最小值输出</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id11">
<h3>2.3 选择构建级别<a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h3>
<p>该软件包使用增量式系统构建来演示完整的定点 无传感器磁场定向控制解决方案。共有 5 个可选的构建级别选项来逐步验证功能。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>构建级别</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>LEVEL1</p></td>
<td><p>模块功能检查。</p></td>
</tr>
<tr class="row-odd"><td><p>LEVEL2</p></td>
<td><p>验证 ADC、帕克/克拉克，校准偏移量。</p></td>
</tr>
<tr class="row-even"><td><p>LEVEL3</p></td>
<td><p>验证电流（扭矩）闭环以及 PID 和速度测量。</p></td>
</tr>
<tr class="row-odd"><td><p>LEVEL4</p></td>
<td><p>验证速度估算和转子位置估算。</p></td>
</tr>
<tr class="row-even"><td><p>LEVEL5</p></td>
<td><p>验证速度闭环、速度 PID 和 eSMO。</p></td>
</tr>
</tbody>
</table>
<p>若要在 foc.h 中选择构建级别，请点击工具栏中的“Project”-&gt;“Properties”。在“Properties”窗口中，依次转到“Build”-&gt;“Arm Compiler”-&gt;“Predefined Symbols”。预定义的 BUILDLEVEL 名称为 LEVEL5。若要更改预定义的构建级别，请点击“Edit”并将 LEVEL5 更改为在 foc.h 中定义的另一个构建级别。</p>
<figure class="align-default" id="id23">
<img alt="构建级别" src="../_images/FOC_BUILD_LEVELS.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">构建级别</span><a class="headerlink" href="#id23" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="id12">
<h3>重要说明<a class="headerlink" href="#id12" title="Permalink to this heading">¶</a></h3>
<p>构建级别仅用于验证模块。当使用低于 LEVEL5 的构建级别时，用户只能在空载条件下使用电机。用户应使用 LEVEL5 作为最终构建级别，以在负载条件下测试电机。</p>
</section>
<section id="id13">
<h3>2.4 用于控制电机的变量<a class="headerlink" href="#id13" title="Permalink to this heading">¶</a></h3>
<p>下方是包含在调试窗口中用于控制电机的变量列表。注意，对于 IQ24 类型的变量，请通过右键点击变量并更改为 IQ 类型 24 来设置类型。</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>变量</p></th>
<th class="head"><p>说明</p></th>
<th class="head"><p>类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>enableFOC</p></td>
<td><p>控制是启用还是禁用 FOC。如果设为 0，则禁用 PWM，并且驱动处于高阻态。如果设为 1，则根据 FOC 代码设置 PWM 输出。</p></td>
<td><p>布尔</p></td>
</tr>
<tr class="row-odd"><td><p>lsw</p></td>
<td><p>控制 FOC 状态。如果设为 0，则将电机与 A 相对齐。如果设为 1，则以 speedRef 变量设置的速度在开环中旋转电机。如果设为 2，则以 speedRef 变量设置的速度在闭环中旋转电机。lsw=2 不适用于 LEVEL5 以外的构建级别，并且不应设置。</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-even"><td><p>idRef</p></td>
<td><p>设置对齐电流（标幺值）。</p></td>
<td><p>IQ24</p></td>
</tr>
<tr class="row-odd"><td><p>iqRef</p></td>
<td><p>设置 lsw = 1 下的 q 轴电流（标幺值）。</p></td>
<td><p>IQ24</p></td>
</tr>
<tr class="row-even"><td><p>speedRef</p></td>
<td><p>设置用于开环加速且 lsw = 2 下的基准速度</p></td>
<td><p>IQ24</p></td>
</tr>
<tr class="row-odd"><td><p>speedEst.EstimatedSpeed</p></td>
<td><p>显示估算的电机速度（标幺值）。</p></td>
<td><p>IQ24</p></td>
</tr>
<tr class="row-even"><td><p>speedEst.EstimatedSpeedRpm</p></td>
<td><p>显示估算的电机速度（以 RPM 为单位）。</p></td>
<td><p>int</p></td>
</tr>
<tr class="row-odd"><td><p>piSpd.Kp</p></td>
<td><p>速度 PI 中的比例常量。</p></td>
<td><p>IQ24</p></td>
</tr>
<tr class="row-even"><td><p>piSpd.Ki</p></td>
<td><p>速度 PI 中的积分常量。</p></td>
<td><p>IQ24</p></td>
</tr>
<tr class="row-odd"><td><p>piId.Kp</p></td>
<td><p>Id 电流 PI 中的比例常量。</p></td>
<td><p>IQ24</p></td>
</tr>
<tr class="row-even"><td><p>piId.Ki</p></td>
<td><p>Id 电流 PI 中的积分常量。</p></td>
<td><p>IQ24</p></td>
</tr>
<tr class="row-odd"><td><p>piIq.Kp</p></td>
<td><p>Iq 电流 PI 中的比例常量。</p></td>
<td><p>IQ24</p></td>
</tr>
<tr class="row-even"><td><p>piIq.Ki</p></td>
<td><p>Iq 电流 PI 中的积分常量。</p></td>
<td><p>IQ24</p></td>
</tr>
<tr class="row-odd"><td><p>guiOverCurrentLimit</p></td>
<td><p>以安培为单位的相电流值，高于该值时，软件将触发过流</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-even"><td><p>guiVmOverVoltageLimit</p></td>
<td><p>以伏特为单位的电压值，高于该值时，软件将触发过压故障。</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-odd"><td><p>guiVmUnderVoltageLimit</p></td>
<td><p>以伏特为单位的电压值，低于该值时，软件将触发欠压故障。</p></td>
<td><p>float</p></td>
</tr>
<tr class="row-even"><td><p>gui_faults.clearFault</p></td>
<td><p>如果设为 1，则清除所有故障位。</p></td>
<td><p>bool</p></td>
</tr>
<tr class="row-odd"><td><p>gui_faults.drvFault</p></td>
<td><p>在检测到 drv 故障时设置。</p></td>
<td><p>bool</p></td>
</tr>
<tr class="row-even"><td><p>gui_faults.uvlo</p></td>
<td><p>在检测到欠压时设置。</p></td>
<td><p>bool</p></td>
</tr>
<tr class="row-odd"><td><p>gui_faults.ovlo</p></td>
<td><p>在检测到过压时设置。</p></td>
<td><p>bool</p></td>
</tr>
<tr class="row-even"><td><p>gui_faults.ocp</p></td>
<td><p>在检测到过流时设置。</p></td>
<td><p>bool</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id14">
<h3>2.5 电机运行<a class="headerlink" href="#id14" title="Permalink to this heading">¶</a></h3>
<p>电机运行的步骤如下：</p>
<ol class="arabic simple">
<li><p>检查 enableFOC 是否为 0。</p></li>
<li><p>检查“gui_faults”结构中是否设置了任何故障位。如果设置了任何故障，请通过设置 gui_faults.clearFault = 1 来清除故障。</p></li>
<li><p>将 idRef 设置为所需的对齐电流。</p></li>
<li><p>将 iqRef 设置为所需的开环电流。</p></li>
<li><p>将 speedRef 设置为所需的开环速度。</p></li>
<li><p>设置 lsw = 0 可使电机与 A 相对齐。请注意，当 enableFOC = 0 时，FOC 当前被禁用。</p></li>
<li><p>设置 enableFOC = 1 可启用 FOC 代码来驱动 PWM。因为 lsw = 0，所以我们应该在 A 相中看到正电流，在 B 相和 C 相中看到一半的负电流。如果电流不是恒定的，请参阅针对 Id 的 PI 调优。</p></li>
<li><p>设置 lsw = 1 可切换到开环。电机开始旋转并加速至在 speedRef 中设置的速度。如果电机振动，则复位为 lsw = 0 并设置更高的 IdRef 值。A 相电流应为正弦波。如果电流存在尖峰或波形失真，请参阅针对 Iq 的 PI 调优。</p></li>
<li><p>设置 lsw = 2 可切换到闭环。估算的电机速度 (speedEst.EstimatedSpeed) 应在负载条件下与 speedRef 匹配，并且电机应继续平稳运行。</p></li>
<li><p>提高或降低 speedRef 则可以所需的电机速度运行。检查斜升后电机速度是否稳定，是否未出现速度振荡，特别是在施加负载时。如果电机速度不稳定或最终速度存在振荡，请使用速度 PI 控制器修改速度控制响应。</p></li>
<li><p>若要停止电机，请设置 enableFOC = 0。</p></li>
<li><p>如果发生故障，则会在 gui_faults 结构中设置相应的故障。</p></li>
<li><p>若要清除故障，请移除故障条件并设置 gui_faults.clearFault。相应的故障位将被清除。</p></li>
</ol>
</section>
<section id="id15">
<h3>2.6 电机调优<a class="headerlink" href="#id15" title="Permalink to this heading">¶</a></h3>
</section>
<section id="pi">
<h3>PI 控制器调优<a class="headerlink" href="#pi" title="Permalink to this heading">¶</a></h3>
<p>共有 3 个 PI 控制器：速度 PI 控制器、Id 电流 PI 控制器和 Iq 电流 PI 控制器。若要对 PI 控制器进行调优，用户应首先调整 Kp，然后调整该 PI 控制器的 Ki。 对 PI 控制器进行调优的方法如下：</p>
<ul class="simple">
<li><p>使用 lsw = 0 可对 PI Id 增益（piId.kp、piId.ki）进行调优</p></li>
<li><p>使用 lsw = 1 可对 PI Iq 增益（piIq.kp、piIq.ki）进行调优</p></li>
<li><p>在 PI 速度增益中使用 lsw = 2（piSpd.kp、piSpd.ki）</p></li>
</ul>
</section>
<section id="id16">
<h3>2.7 记录变量<a class="headerlink" href="#id16" title="Permalink to this heading">¶</a></h3>
<p>用户可以添加 __ENABLE_LOG 预定义符号来启用日志记录。用户可以设置日志索引和变量，如以下代码所示：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FOC_addVarToLog</span><span class="p">(</span><span class="n">FOC_LOG_IDX_0</span><span class="p">,</span> <span class="n">phaseVolt</span><span class="o">.</span><span class="n">Valpha</span><span class="p">);</span>
</pre></div>
</div>
<p>若要以图表形式查看记录的数据，用户可以添加变量 cssLog[X]，其中 X 是索引。右键点击该变量，然后选择“Graph”。</p>
<figure class="align-default" id="id24">
<img alt="图形图像" src="../_images/CCS_GRAPH.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">图形图像</span><a class="headerlink" href="#id24" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>选择“Continuous Refresh”模式可查看连续数据。</p>
<figure class="align-default" id="id25">
<img alt="图形图像" src="../_images/CCS_GRAPH_CONT_REFRESH.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">图形图像</span><a class="headerlink" href="#id25" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>请注意，启用日志记录功能后，软件会占用 24KB 的额外 SRAM 空间来存储值。</strong></p>
</section>
<section id="spi">
<h3>2.8 访问 SPI 寄存器<a class="headerlink" href="#spi" title="Permalink to this heading">¶</a></h3>
<p>软件允许分别更改 DRV SPI 寄存器中的值。可通过 3 个选项写入 SPI 寄存器。下面是要使用的变量和示例。</p>
<p>SPI 寄存器中有 3 个选项：</p>
<ol class="arabic simple">
<li><p>将 8 位数据写入寄存器</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>变量</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>gui_spi.writeRegFlag</p></td>
<td><p>设为 1 时写入寄存器。</p></td>
</tr>
<tr class="row-odd"><td><p>gui_spi.writeRegAddr</p></td>
<td><p>设置要写入的寄存器地址。</p></td>
</tr>
<tr class="row-even"><td><p>gui_spi.writeRegData</p></td>
<td><p>设置要写入的寄存器数据。</p></td>
</tr>
</tbody>
</table>
<p>例如，若要将 0x01 写入栅极驱动器 HS 寄存器，请选择 gui_spi.writeRegAddr 为 DRV8323RS_REG_ADDR_GATE_DRIVE_HS，设置 gui_spi.writeRegData = 0x01，然后设置 gui_spi.writeRegFlag = 1。</p>
<ol class="arabic simple" start="2">
<li><p>更新 SPI 寄存器中的某些位</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>变量</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>gui_spi.writeBitfieldRegFlag</p></td>
<td><p>设为 1 时写入位字段。</p></td>
</tr>
<tr class="row-odd"><td><p>gui_spi.writeBitfieldRegAddr</p></td>
<td><p>设置要写入位字段的寄存器地址。</p></td>
</tr>
<tr class="row-even"><td><p>gui_spi.bitfieldRegPosData</p></td>
<td><p>设置要写入位字段的位置。</p></td>
</tr>
<tr class="row-odd"><td><p>gui_spi.bitfieldRegMaskData</p></td>
<td><p>设置要写入位字段的掩码。</p></td>
</tr>
<tr class="row-even"><td><p>gui_spi.writeBitfieldRegData</p></td>
<td><p>设置要写入位字段的数据。</p></td>
</tr>
</tbody>
</table>
<p>若要设置 IDRIVEP_HS = 0x03 寄存器，请选择 gui_spi.writeBitfieldRegAddr 为 DRV8323RS_REG_ADDR_GATE_DRIVE_HS，设置 gui_spi.bitfieldRegPosData = 0x04，设置 gui_spi.bitfieldRegMaskData = 0x03，设置 gui_spi.writeBitfieldRegData = 0x03，然后设置 gui_spi.writeBitfieldRegFlag = 1。</p>
<ol class="arabic simple" start="3">
<li><p>读取 SPI 寄存器</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>变量</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>gui_spi.readRegFlag</p></td>
<td><p>设为 1 时读取寄存器。</p></td>
</tr>
<tr class="row-odd"><td><p>gui_spi.readRegAddr</p></td>
<td><p>设置要读取的寄存器地址。</p></td>
</tr>
<tr class="row-even"><td><p>gui_spi.readRegData</p></td>
<td><p>显示从寄存器读取的数据。</p></td>
</tr>
</tbody>
</table>
<p>若要读取栅极驱动器 HS 寄存器，请选择 gui_spi.readRegAddr 为 DRV8323RS_REG_ADDR_GATE_DRIVE_HS，然后设置 gui_spi.writeRegFlag = 1。读取的数据可以在 gui_spi.readRegData 中看到。</p>
</section>
</section>
<section id="id17">
<h2>3. API 指南<a class="headerlink" href="#id17" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="../../doxygen/api_guide/html/index.html">无传感器 FOC API 指南</a></p></li>
</ul>
</section>
<section id="id18">
<h2>4. 已知问题<a class="headerlink" href="#id18" title="Permalink to this heading">¶</a></h2>
<p>1.编译时针对 IQrepeat 函数发出函数隐式声明警告。 2.当前的解决方案支持高达 100W 的功率。在低速下施加高扭矩会导致电机以高 rpm 向后旋转。</p>
</section>
<section id="id19">
<h2>5. 支持的器件<a class="headerlink" href="#id19" title="Permalink to this heading">¶</a></h2>
<section id="drv8323rs">
<h3>DRV8323RS<a class="headerlink" href="#drv8323rs" title="Permalink to this heading">¶</a></h3>
<p>支持的 MSPM0 Launchpad</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.ti.com/tool/LP-MSPM0G3507">LP-MSPM0G3507</a></p></li>
</ul>
<p>链接</p>
<ul class="simple">
<li><p><a class="reference external" href="drv8323rs/DRV8323RS_Hardware_User_Guide_CN.html">硬件用户指南</a></p></li>
<li><p><a class="reference external" href="drv8323rs/DRV8323RS_GUI_User_Guide_CN.html">GUI 用户指南</a></p></li>
<li><p><a class="reference external" href="https://dev.ti.com/gallery/view/TIMSPGC/MSPM0G-DRV8323RS-EVM-GUI">MSPM0G3507-DRV8323RS-EVM-GUI</a></p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Sensorless FOC Motor Control User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="drv8323rs/DRV8323RS_GUI_User_Guide_CN.html" class="btn btn-neutral float-right" title="DRV8323RS GUI User Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1995-2023, Texas Instruments Incorporated. All rights reserved.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>